<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>Websocket Based HTML5 IRC Client</title>
	</head>
	<body>
		<p>Websocket Based HTML5 IRC Client</p>
		<div id="chat"></div>
		<form id="conversation" onsubmit="DispatchText()" action="javascript:void(0);">
			<input type="text" id="message" name="message" autocomplete="off" style="width:700px" />
			<input type="submit" id="sub" name="sub" value="Send" style="width:90px" />
		</form>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
		<script type="text/javascript">
	var ws = new WebSocket("ws://{{ host }}:{{ port }}/websocket");
	var message_list = new Array();
	ws.onmessage = function(evt)
	{
		var msg = JSON.parse(evt.data);
		if(msg.type == 'PrivMessage')
		{
			message_list.push(msg.msg);
			if(message_list.length > 10){message_list.shift();}
			Update();
		}
	}
	function DispatchText(){
		var userInput = document.getElementById("message").value;
		document.getElementById("message").value = "";
		ws.send(userInput);
	}
	function Update(){
		$('#conversation').remove()
		
		var arrayLength = message_list.length;
		var newTable = document.createElement('table');
		newTable.setAttribute("id", "conversation");

		for (var i = 0, tr, td; i < arrayLength; i++) {
    	tr = document.createElement('tr');
    	td = document.createElement('td');
    	td.appendChild(document.createTextNode(message_list[i]));
    	tr.appendChild(td);
    	newTable.appendChild(tr);
		}
		$('#chat').append(newTable);
	}

		</script>
	</body>
</html>
